<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Complete | AI Proctor</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1f2937;
    --primary: #8b5cf6;
    --accent: #22d3ee;
    --green: #10b981;
    --red: #ef4444;
    --orange: #f59e0b;
    --text: #e5e7eb;
    --muted: #6b7280;
    --border: rgba(255,255,255,0.08);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    min-height: 100vh;
    background: var(--bg);
    color: var(--text);
    overflow-x: hidden;
}

/* Background Animation */
.bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
}

.bg-animation::before {
    content: '';
    position: absolute;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(139,92,246,0.15) 0%, transparent 70%);
    top: -200px;
    right: -200px;
    animation: float 8s ease-in-out infinite;
}

.bg-animation::after {
    content: '';
    position: absolute;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(34,211,238,0.1) 0%, transparent 70%);
    bottom: -150px;
    left: -150px;
    animation: float 10s ease-in-out infinite reverse;
}

@keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    50% { transform: translate(30px, 30px) rotate(5deg); }
}

/* Header */
header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    background: rgba(10, 14, 26, 0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
}

.navbar {
    max-width: 1200px;
    margin: auto;
    padding: 14px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo img {
    width: 40px;
    height: 40px;
    border-radius: 10px;
}

.logo span {
    font-size: 22px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Main Container */
.container {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    padding: 100px 20px 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 30px;
}

/* Success Card */
.success-card {
    max-width: 500px;
    width: 100%;
    background: rgba(17, 24, 39, 0.8);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 40px;
    text-align: center;
    animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 40px rgba(139, 92, 246, 0.15);
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Checkmark Animation */
.checkmark-container {
    width: 100px;
    height: 100px;
    margin: 0 auto 25px;
    position: relative;
}

.checkmark-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
    animation: scaleIn 0.5s ease 0.2s both, pulse 2s ease-in-out 1s infinite;
}

@keyframes scaleIn {
    from { transform: scale(0); }
    to { transform: scale(1); }
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
    50% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
}

.checkmark {
    width: 50px;
    height: 50px;
    stroke: var(--green);
    stroke-width: 3;
    fill: none;
    animation: draw 0.6s ease 0.5s both;
}

@keyframes draw {
    from { stroke-dashoffset: 100; }
    to { stroke-dashoffset: 0; }
}

.checkmark path {
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    animation: draw 0.6s ease 0.5s forwards;
}

.success-card h1 {
    font-size: 28px;
    font-weight: 700;
    color: var(--green);
    margin-bottom: 8px;
    animation: fadeIn 0.5s ease 0.6s both;
}

.success-card .subtitle {
    font-size: 15px;
    color: var(--muted);
    margin-bottom: 30px;
    animation: fadeIn 0.5s ease 0.7s both;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Score Display */
.score-display {
    background: linear-gradient(135deg, rgba(139,92,246,0.15), rgba(34,211,238,0.1));
    border: 1px solid rgba(139,92,246,0.3);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 25px;
    animation: fadeIn 0.5s ease 0.8s both;
}

.score-label {
    font-size: 13px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
}

.score-value {
    font-size: 48px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
}

.score-value span {
    font-size: 24px;
    color: var(--muted);
    -webkit-text-fill-color: var(--muted);
}

.score-percentage {
    font-size: 16px;
    color: var(--green);
    margin-top: 8px;
}

.score-percentage.warning { color: var(--orange); }
.score-percentage.danger { color: var(--red); }

/* Penalty Badge */
.penalty-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(239,68,68,0.15);
    border: 1px solid rgba(239,68,68,0.3);
    color: var(--red);
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 500;
    margin-top: 12px;
    animation: shake 0.5s ease 1s both;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-5px); }
    40%, 80% { transform: translateX(5px); }
}

.original-score {
    font-size: 14px;
    color: var(--muted);
    margin-top: 8px;
    text-decoration: line-through;
}

/* Subject Badge */
.subject-badge {
    display: inline-block;
    background: rgba(139,92,246,0.15);
    border: 1px solid rgba(139,92,246,0.3);
    color: #c4b5fd;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 20px;
    animation: fadeIn 0.5s ease 0.75s both;
}

/* Buttons */
.btn-group {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    animation: fadeIn 0.5s ease 0.9s both;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 28px;
    border-radius: 30px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    border: none;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), #6366f1);
    color: #fff;
    box-shadow: 0 8px 25px rgba(139,92,246,0.4);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(139,92,246,0.5);
}

.btn-secondary {
    background: rgba(255,255,255,0.08);
    color: var(--text);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background: rgba(255,255,255,0.12);
    transform: translateY(-3px);
}

/* Activity Card */
.activity-card {
    max-width: 600px;
    width: 100%;
    background: rgba(17, 24, 39, 0.8);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 30px;
    animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.3s both;
}

.activity-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border);
}

.activity-header h2 {
    font-size: 18px;
    font-weight: 600;
}

.activity-icon {
    width: 40px;
    height: 40px;
    background: rgba(245,158,11,0.15);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

/* Activity Grid */
.activity-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.activity-item {
    background: var(--surface2);
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
    animation: fadeInUp 0.5s ease both;
}

.activity-item:nth-child(1) { animation-delay: 0.4s; }
.activity-item:nth-child(2) { animation-delay: 0.5s; }
.activity-item:nth-child(3) { animation-delay: 0.6s; }
.activity-item:nth-child(4) { animation-delay: 0.7s; }
.activity-item:nth-child(5) { animation-delay: 0.8s; }
.activity-item:nth-child(6) { animation-delay: 0.9s; }
.activity-item:nth-child(7) { animation-delay: 1.0s; }
.activity-item:nth-child(8) { animation-delay: 1.1s; }

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.activity-item:hover {
    transform: translateY(-5px);
    border-color: rgba(139,92,246,0.3);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.activity-item.clean {
    border-color: rgba(16,185,129,0.3);
    background: rgba(16,185,129,0.05);
}

.activity-item.warning {
    border-color: rgba(245,158,11,0.3);
    background: rgba(245,158,11,0.05);
}

.activity-item.danger {
    border-color: rgba(239,68,68,0.3);
    background: rgba(239,68,68,0.05);
}

.activity-count {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 5px;
}

.activity-item.clean .activity-count { color: var(--green); }
.activity-item.warning .activity-count { color: var(--orange); }
.activity-item.danger .activity-count { color: var(--red); }

.activity-label {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.activity-emoji {
    font-size: 24px;
    margin-bottom: 8px;
}

/* Status Badge */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    margin-top: 20px;
}

.status-badge.clean {
    background: rgba(16,185,129,0.15);
    color: var(--green);
    border: 1px solid rgba(16,185,129,0.3);
}

.status-badge.warning {
    background: rgba(245,158,11,0.15);
    color: var(--orange);
    border: 1px solid rgba(245,158,11,0.3);
}

.status-badge.danger {
    background: rgba(239,68,68,0.15);
    color: var(--red);
    border: 1px solid rgba(239,68,68,0.3);
}

/* Confetti Animation for high scores */
.confetti {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
    overflow: hidden;
}

.confetti-piece {
    position: absolute;
    width: 10px;
    height: 10px;
    top: -20px;
    animation: confetti-fall 3s ease-out forwards;
}

@keyframes confetti-fall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* Responsive */
@media (max-width: 600px) {
    .success-card, .activity-card {
        padding: 25px;
    }
    
    .score-value {
        font-size: 40px;
    }
    
    .activity-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>
</head>
<body>

<!-- Background Animation -->
<div class="bg-animation"></div>

<!-- Confetti for high scores -->
<div class="confetti" id="confetti"></div>

<!-- Header -->
<header>
    <div class="navbar">
        <div class="logo">
            <img src="/static/home.jpg" alt="Logo">
            <span>AI Proctor</span>
        </div>
    </div>
</header>

<!-- Main Container -->
<div class="container">

    <!-- Success Card -->
    <div class="success-card">
        <!-- Animated Checkmark -->
        <div class="checkmark-container">
            <div class="checkmark-circle">
                <svg class="checkmark" viewBox="0 0 50 50">
                    <path d="M14 27 L22 35 L38 16" />
                </svg>
            </div>
        </div>

        <h1>ğŸ‰ Exam Complete!</h1>
        <p class="subtitle">Your exam has been successfully submitted</p>

        <!-- Subject Badge -->
        <div class="subject-badge">ğŸ“š {{ subject }}</div>

        <!-- Score Display -->
        <div class="score-display">
            <div class="score-label">Your Score</div>
            <div class="score-value">{{ score }}<span>/{{ total_questions }}</span></div>
            {% set percentage = (score / total_questions * 100) | int if total_questions > 0 else 0 %}
            <div class="score-percentage {% if percentage >= 70 %}{% elif percentage >= 40 %}warning{% else %}danger{% endif %}">
                {{ percentage }}% 
                {% if percentage >= 80 %}ğŸŒŸ Excellent!
                {% elif percentage >= 70 %}ğŸ‘ Good Job!
                {% elif percentage >= 50 %}ğŸ“– Keep Practicing
                {% else %}ğŸ’ª Need Improvement
                {% endif %}
            </div>
            {% if penalty_applied > 0 %}
            <div class="original-score">Original: {{ original_score }}/{{ total_questions }}</div>
            <div class="penalty-badge">
                âš ï¸ -{{ penalty_applied }} marks penalty ({{ total_malpractice }} violations detected)
            </div>
            {% endif %}
        </div>

        <!-- Buttons -->
        <div class="btn-group">
            <a href="{{ url_for('student_dashboard') }}" class="btn btn-primary">
                ğŸ  Dashboard
            </a>
            <button class="btn btn-secondary" onclick="downloadResult()">
                ğŸ“¥ Download Result
            </button>
        </div>
    </div>

    <!-- Activity Card -->
    <div class="activity-card">
        <div class="activity-header">
            <div class="activity-icon">ğŸ“Š</div>
            <h2>Exam Activity & Proctoring Summary</h2>
        </div>

        <div class="activity-grid">
            <div class="activity-item {% if tab_switch_count == 0 %}clean{% elif tab_switch_count <= 3 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ”„</div>
                <div class="activity-count">{{ tab_switch_count }}</div>
                <div class="activity-label">Tab Switches</div>
            </div>

            <div class="activity-item {% if looking_away_count == 0 %}clean{% elif looking_away_count <= 5 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ‘€</div>
                <div class="activity-count">{{ looking_away_count }}</div>
                <div class="activity-label">Look Away</div>
            </div>

            <div class="activity-item {% if cheating_count == 0 %}clean{% elif cheating_count <= 3 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ‘¥</div>
                <div class="activity-count">{{ cheating_count }}</div>
                <div class="activity-label">Multiple Persons</div>
            </div>

            <div class="activity-item {% if camera_hidden_count == 0 %}clean{% elif camera_hidden_count <= 2 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ“·</div>
                <div class="activity-count">{{ camera_hidden_count }}</div>
                <div class="activity-label">Camera Hidden</div>
            </div>

            <div class="activity-item {% if hand_cover_count == 0 %}clean{% elif hand_cover_count <= 3 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">âœ‹</div>
                <div class="activity-count">{{ hand_cover_count }}</div>
                <div class="activity-label">Hand Cover</div>
            </div>

            <div class="activity-item {% if eye_tracker_count == 0 %}clean{% elif eye_tracker_count <= 5 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ‘ï¸</div>
                <div class="activity-count">{{ eye_tracker_count }}</div>
                <div class="activity-label">Eye Movement</div>
            </div>

            <div class="activity-item {% if head_movement_count == 0 %}clean{% elif head_movement_count <= 5 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ”ƒ</div>
                <div class="activity-count">{{ head_movement_count }}</div>
                <div class="activity-label">Head Movement</div>
            </div>

            <div class="activity-item {% if no_blink_count == 0 %}clean{% elif no_blink_count <= 3 %}warning{% else %}danger{% endif %}">
                <div class="activity-emoji">ğŸ˜</div>
                <div class="activity-count">{{ no_blink_count }}</div>
                <div class="activity-label">No Blink</div>
            </div>
        </div>

        <!-- Overall Status -->
        {% set total_violations = tab_switch_count + looking_away_count + cheating_count + camera_hidden_count + hand_cover_count %}
        <div style="text-align: center;">
            {% if terminated %}
            <div class="status-badge danger">
                âŒ Exam Terminated - Excessive Malpractice Detected
            </div>
            {% elif total_violations == 0 %}
            <div class="status-badge clean">
                âœ… Clean Exam - No Malpractice Detected
            </div>
            {% elif total_violations <= 5 %}
            <div class="status-badge warning">
                âš ï¸ Minor Violations Detected
            </div>
            {% else %}
            <div class="status-badge danger">
                â— Multiple Violations Detected
            </div>
            {% endif %}
        </div>
    </div>

</div>

<!-- Data attributes for JavaScript (avoids Jinja2 in JS) -->
<div id="exam-data" style="display:none;"
    data-username="{{ username }}"
    data-subject="{{ subject }}"
    data-score="{{ score }}"
    data-original-score="{{ original_score }}"
    data-penalty-applied="{{ penalty_applied }}"
    data-total-malpractice="{{ total_malpractice }}"
    data-total="{{ total_questions }}"
    data-percentage="{{ (score / total_questions * 100) | int if total_questions > 0 else 0 }}"
    data-tab-switch="{{ tab_switch_count }}"
    data-looking-away="{{ looking_away_count }}"
    data-cheating="{{ cheating_count }}"
    data-camera-hidden="{{ camera_hidden_count }}"
    data-hand-cover="{{ hand_cover_count }}"
    data-eye-tracker="{{ eye_tracker_count }}"
    data-head-movement="{{ head_movement_count }}"
    data-no-blink="{{ no_blink_count }}"
    data-terminated="{{ 'true' if terminated else 'false' }}">
</div>

<script>
// Get data from HTML element (avoids Jinja2 syntax in JS)
var examDataEl = document.getElementById('exam-data');
var EXAM_DATA = {
    username: examDataEl.dataset.username,
    subject: examDataEl.dataset.subject,
    score: examDataEl.dataset.score,
    originalScore: examDataEl.dataset.originalScore,
    penaltyApplied: parseInt(examDataEl.dataset.penaltyApplied) || 0,
    totalMalpractice: parseInt(examDataEl.dataset.totalMalpractice) || 0,
    total: examDataEl.dataset.total,
    percentage: parseInt(examDataEl.dataset.percentage),
    tabSwitch: parseInt(examDataEl.dataset.tabSwitch),
    lookingAway: parseInt(examDataEl.dataset.lookingAway),
    cheating: parseInt(examDataEl.dataset.cheating),
    cameraHidden: parseInt(examDataEl.dataset.cameraHidden),
    handCover: parseInt(examDataEl.dataset.handCover),
    eyeTracker: parseInt(examDataEl.dataset.eyeTracker),
    headMovement: parseInt(examDataEl.dataset.headMovement),
    noBlink: parseInt(examDataEl.dataset.noBlink),
    terminated: examDataEl.dataset.terminated === 'true'
};

// Download Result Function
function downloadResult() {
    var resultData = {
        student: EXAM_DATA.username,
        subject: EXAM_DATA.subject,
        score: EXAM_DATA.score + "/" + EXAM_DATA.total,
        originalScore: EXAM_DATA.originalScore + "/" + EXAM_DATA.total,
        penaltyApplied: EXAM_DATA.penaltyApplied,
        totalMalpractice: EXAM_DATA.totalMalpractice,
        percentage: EXAM_DATA.percentage + "%",
        date: new Date().toLocaleString(),
        activity: {
            tab_switches: EXAM_DATA.tabSwitch,
            looking_away: EXAM_DATA.lookingAway,
            multiple_persons: EXAM_DATA.cheating,
            camera_hidden: EXAM_DATA.cameraHidden,
            hand_cover: EXAM_DATA.handCover,
            eye_movement: EXAM_DATA.eyeTracker,
            head_movement: EXAM_DATA.headMovement,
            no_blink: EXAM_DATA.noBlink
        },
        terminated: EXAM_DATA.terminated
    };

    // Build penalty section if applicable
    var penaltySection = "";
    if (resultData.penaltyApplied > 0) {
        penaltySection = 
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                    PENALTY APPLIED                       â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                                                          â•‘\n" +
"â•‘  Original Score: " + resultData.originalScore + "\n" +
"â•‘  Penalty: -" + resultData.penaltyApplied + " marks\n" +
"â•‘  Total Violations: " + resultData.totalMalpractice + " (threshold: >2)\n" +
"â•‘  Final Score: " + resultData.score + "\n" +
"â•‘                                                          â•‘\n";
    }

    // Create text content
    var content = "\n" +
"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n" +
"â•‘                    EXAM RESULT CERTIFICATE                â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                                                          â•‘\n" +
"â•‘  Student: " + resultData.student + "\n" +
"â•‘  Subject: " + resultData.subject + "\n" +
"â•‘  Date: " + resultData.date + "\n" +
"â•‘                                                          â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                         SCORE                            â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                                                          â•‘\n" +
"â•‘  Score: " + resultData.score + "\n" +
"â•‘  Percentage: " + resultData.percentage + "\n" +
"â•‘                                                          â•‘\n" +
penaltySection +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                   PROCTORING ACTIVITY                    â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘                                                          â•‘\n" +
"â•‘  Tab Switches: " + resultData.activity.tab_switches + "\n" +
"â•‘  Looking Away: " + resultData.activity.looking_away + "\n" +
"â•‘  Multiple Persons Detected: " + resultData.activity.multiple_persons + "\n" +
"â•‘  Camera Hidden: " + resultData.activity.camera_hidden + "\n" +
"â•‘  Hand Cover: " + resultData.activity.hand_cover + "\n" +
"â•‘  Eye Movement Alerts: " + resultData.activity.eye_movement + "\n" +
"â•‘  Head Movement Alerts: " + resultData.activity.head_movement + "\n" +
"â•‘  No Blink Alerts: " + resultData.activity.no_blink + "\n" +
"â•‘                                                          â•‘\n" +
"â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n" +
"â•‘  Status: " + (resultData.terminated ? 'TERMINATED - Excessive Malpractice' : 'COMPLETED SUCCESSFULLY') + "\n" +
"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n" +
"\nGenerated by AI Proctor System\n";

    // Create blob and download
    var blob = new Blob([content], { type: 'text/plain' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'exam_result_' + resultData.subject.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Confetti Animation for high scores
function createConfetti() {
    var confettiContainer = document.getElementById('confetti');
    var colors = ['#8b5cf6', '#22d3ee', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
    
    for (var i = 0; i < 50; i++) {
        (function(index) {
            setTimeout(function() {
                var confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confettiContainer.appendChild(confetti);
                
                setTimeout(function() { confetti.remove(); }, 4000);
            }, index * 50);
        })(i);
    }
}

// Trigger confetti on page load for high scores
if (EXAM_DATA.percentage >= 70 && !EXAM_DATA.terminated) {
    setTimeout(createConfetti, 800);
}

// Play success sound
function playSuccessSound() {
    try {
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        var notes = [523, 659, 784]; // C, E, G chord
        notes.forEach(function(freq, i) {
            setTimeout(function() {
                var osc = ctx.createOscillator();
                var gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = freq;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.5);
            }, i * 150);
        });
    } catch(e) {}
}

// Play sound after page load
setTimeout(playSuccessSound, 500);
</script>

</body>
</html>
