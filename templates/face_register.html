<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Face Registration</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Roboto',sans-serif;
}

/* ===== FULL PAGE BACKGROUND IMAGE ===== */
body{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background: url("/static/home.jpg") center/cover no-repeat fixed;
    background-size: cover;
    color:#e0e0e0;
    overflow: hidden;
    position: relative;
}

/* ===== GLASS CONTAINER ===== */
.container{
    background:rgba(0,0,0,0.75);
    backdrop-filter:blur(25px);
    border-radius:20px;
    padding:50px;
    width:100%;
    max-width:520px;
    text-align:center;
    box-shadow:
        0 30px 60px rgba(0,0,0,0.9),
        0 0 40px rgba(0,255,255,0.4),
        inset 0 1px 0 rgba(255,255,255,0.1);
    animation:fadeUp 0.8s ease-out;
    position:relative;
    z-index:1;
    border: 1px solid rgba(255,255,255,0.1);
}

@keyframes fadeUp{
    from{opacity:0; transform:translateY(50px) scale(0.9)}
    to{opacity:1; transform:translateY(0) scale(1)}
}

/* ===== TEXT ===== */
h2{
    color:#ffffff;
    font-weight:500;
    margin-bottom:15px;
    text-shadow:0 0 15px rgba(0,255,255,0.7);
    animation: glowText 2s infinite alternate;
}

@keyframes glowText {
    from { text-shadow: 0 0 15px rgba(0,255,255,0.7); }
    to { text-shadow: 0 0 25px rgba(0,255,255,1); }
}

.user-info{
    margin-bottom:25px;
    font-size:18px;
    color:#cfcfcf;
    animation: fadeIn 1s ease-out 0.3s both;
}

.user-info b{
    color:#00ffff;
    animation: colorShift 3s infinite;
}

@keyframes colorShift {
    0%, 100% { color: #00ffff; }
    50% { color: #ff00ff; }
}

/* ===== CAMERA ===== */
.video-container{
    margin:25px 0;
    animation: slideInUp 1s ease-out 0.5s both;
}

@keyframes slideInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

video{
    width:100%;
    max-width:360px;
    border-radius:16px;
    border:2px solid rgba(255,255,255,0.2);
    box-shadow:
        0 15px 40px rgba(0,0,0,0.8),
        0 0 25px rgba(0,255,255,0.4);
}

/* ===== BUTTON ===== */
button{
    margin-top:30px;
    padding:16px 40px;
    font-size:17px;
    font-weight:500;
    border:none;
    border-radius:35px;
    background:white;
    color:#000;
    cursor:pointer;
    transition: all 0.4s ease;
    box-shadow:0 8px 25px rgba(0,255,255,0.5);
    position: relative;
    overflow: hidden;
    animation: buttonGlow 2s infinite alternate;
}

@keyframes buttonGlow {
    from { box-shadow: 0 8px 25px rgba(0,255,255,0.5); }
    to { box-shadow: 0 8px 25px rgba(0,255,255,0.8); }
}

button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.6s ease;
}

button:hover::before {
    left: 100%;
}

button:hover{
    transform:translateY(-4px) scale(1.05);
    box-shadow:0 15px 40px rgba(0,255,255,0.8);
}

button:active{
    transform:scale(0.98);
}

/* ===== MESSAGE ===== */
#msg{
    margin-top:20px;
    font-weight:500;
    min-height:28px;
    animation: fadeIn 0.5s ease-out;
}

.success{ 
    color:#00ff99; 
    animation: successPulse 1s infinite;
}
.error{ 
    color:#ff4d4d; 
    animation: errorShake 0.5s ease-in-out;
}
.processing{ 
    color:#ffd700; 
    animation: processingBlink 1s infinite;
}

@keyframes successPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

@keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes processingBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

canvas{ display:none }

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
    .container{
        padding:35px;
        margin:20px;
        max-width:90%;
    }
    h2{
        font-size:24px;
    }
    .user-info{
        font-size:16px;
    }
    video{
        max-width:280px;
    }
    button{
        padding:14px 30px;
        font-size:16px;
    }
}

@media(max-width:480px){
    .container{
        padding:25px;
        margin:15px;
    }
    h2{
        font-size:20px;
    }
    .user-info{
        font-size:14px;
        margin-bottom:20px;
    }
    video{
        max-width:240px;
    }
    button{
        padding:12px 25px;
        font-size:15px;
        margin-top:20px;
    }
    #msg{
        font-size:14px;
    }
}
</style>
</head>

<body>

<div class="container">
    <h2>Face Registration</h2>
    <p class="user-info">User: <b>{{ username }}</b></p>

    <div class="video-container">
        <video id="video" autoplay></video>
    </div>

    <canvas id="canvas" width="320" height="240"></canvas>

    <button onclick="captureFace()">Capture & Save Face</button>

    <p id="msg"></p>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const msg = document.getElementById("msg");

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => video.srcObject = stream)
.catch(() => alert("Camera permission denied"));

function captureFace(){
    msg.innerText="Processing...";
    msg.className="processing";

    const ctx=canvas.getContext("2d");
    ctx.drawImage(video,0,0,320,240);
    const imageData=canvas.toDataURL("image/jpeg");

    fetch("/face_register",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ image:imageData })
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.status==="success"){
            msg.innerText="✅ Face captured successfully!";
            msg.className="success";
            setTimeout(()=>window.location.href="/credentials",1000);
        }else{
            msg.innerText="❌ Face capture failed. Try again.";
            msg.className="error";
        }
    })
    .catch(()=>{
        msg.innerText="❌ Server error";
        msg.className="error";
    });
}
</script>

</body>
</html>